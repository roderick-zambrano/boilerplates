version = "3.9"

[services.speedtest-tracker]
image = "ghcr.io/alexjustesen/speedtest-tracker:latest"
security_opt = ["no-new-privileges:true"]
container_name = "speedtest-tracker"
hostname = "speedtest-tracker"
networks = [ "speedtest_tracker" ]
# ports = [
#   "443:443"
# ]
restart = "always"
depends_on = [
  "db"
]
[services.speedtest-tracker.environment]
PUID = 1000
PGID = 1000
DISPLAY_TIMEZONE = "America/Panama"
SPEEDTEST_SCHEDULE = "*/30 * * * *"
SPEEDTEST_SERVERS = "" # Comma-delimited server IDs. See README for more information.
DB_CONNECTION = "mysql"
DB_HOST = "db"
DB_PORT = 3306
DB_DATABASE = "speedtest_tracker"
DB_USERNAME = "speedy"
DB_PASSWORD = "password"
APP_KEY = "" # To generate, drop into container shell, copy raw result from php artisan key:generate --show or simply go to https://speedtest-tracker.dev
# TELEGRAM_BOT_TOKEN = "" # For Telegram bot functionality, provide the token generated by Telegram's BotFather.
[[services.speedtest-tracker.volumes]]
type = "volume"
source = "data"
target = "/config"
[[services.speedtest-tracker.volumes]]
type = "bind"
source = "/etc/localtime"
target = "/etc/localtime"

[services.db]
image = "mariadb:10"
security_opt = ["no-new-privileges:true"]
container_name = "speedtest-db"
networks = [ "speedtest_tracker" ]
restart = "always"
[services.db.environment]
MARIADB_DATABASE = "speedtest_tracker"
MARIADB_USER = "speedy"
MARIADB_PASSWORD = "password"
MARIADB_RANDOM_ROOT_PASSWORD = "true"
[[services.db.volumes]]
type = "volume"
source = "db"
target = "/var/lib/mysql"
[[services.db.volumes]]
type = "bind"
source = "/etc/localtime"
target = "/etc/localtime"

[volumes.data]
[volumes.db]

[networks.speedtest_tracker]
external = true
